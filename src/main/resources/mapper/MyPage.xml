<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.skhuMentoring.mapper.MyPageMapper">
    <!--멘토 DB뿌리기-->
    <select id="getMentorStatus" resultType="com.skhuMentoring.dto.Mentor">
        select * from tbl_mentorBoard;
    </select>
    <!--멘티 DB뿌리기-->
    <select id="getMenteeStatus" resultType="com.skhuMentoring.dto.Mentee">
        select * from tbl_menteeBoard;
    </select>
    <!-- 마이페이지 멘토현황 뿌리기 -->
    <select id="getMenteeMyStatus" resultType="com.skhuMentoring.dto.Mentee">
        select * from tbl_menteeBoard where userId = #{userId};
    </select>
    <!-- 마이페이지 멘티현황 뿌리기 -->
    <select id="getMentorMyStatus" resultType="com.skhuMentoring.dto.Mentor">
        select * from tbl_mentorBoard where userId = #{userId};
    </select>

    <select id="getMentoring" resultType="com.skhuMentoring.dto.Mentoring">
        select * from tbl_mentoring;
    </select>




    <!--멘토링 종료-->
    <delete id="endMentoring">
        delete from tbl_mentorBoard where subjectName =#{subjectName}
    </delete>

    <delete id="requestAccept">
        delete from tbl_menteeBoard where bno =#{bno}
    </delete>

    <delete id="requestRefusal">
        delete from tbl_menteeBoard where userStudentNum =#{userStudentNum}
    </delete>

    <insert id="requestAcceptData" >
        insert into tbl_mentoring(mentorId) values (#{mentorId})
    </insert>

    <select id="whoIsMentee" resultType="_int">
        select * from tbl_menteeBoard where userStudentNum =#{userStudentNum}
    </select>

    <!--마이페이지 멘토에게 보낸요청-->
    <select id="getApplicationMentor" resultType="com.skhuMentoring.dto.Mentee">
        select * from tbl_AppilcationMentor where menteeId = #{menteeId}
    </select>

    <select id="getApplicationMentee" resultType="com.skhuMentoring.dto.Mentee">
        select * from tbl_AppilcationMentee where mentorId = #{mentorId}
    </select>

    <!--마이페이지 멘티에게 받은요청-->
    <select id="getRequestMentee" resultType="com.skhuMentoring.dto.Mentee">
        select a.*, m.userId
        from tbl_mentorboard m JOIN tbl_AppilcationMentor a on m.bno = a.bno
        where m.userId = #{mentorId}
    </select>

    <!--마이페이지 멘티에게 받은 요청에서 멘티 상세보기-->
    <select id="getDetailMentee" resultType="com.skhuMentoring.dto.Mentee">
        select a.*, m.userId
        from tbl_mentorboard m JOIN tbl_AppilcationMentor a on m.bno = a.bno
        where a.bno = #{bno}
    </select>

<!--    &lt;!&ndash;  마이페이지 내 정보 수정  &ndash;&gt;-->
<!--    <update id="modifyUserInfo">-->
<!--        UPDATE tbl_user-->
<!--        SET userPw = #{userPw}, userName = #{userName}, department = #{department}, userStudentNum = #{userStudentNum},-->
<!--                            userEmail = #{userEmail}, userPhoneNum = #{userPhoneNum}-->
<!--        WHERE userId = #{userId}-->
<!--     </update>-->

    <!-- 마이페이지 내 정보 수정 -->
    <update id="modifyUserInfo">
        UPDATE tbl_user
        SET userPw = #{userPw}, userName = #{userName}, department = #{department}, userStudentNum = #{userStudentNum}, userEmail = #{userEmail}, userPhoneNum = #{userPhoneNum}
        WHERE userId = #{userId};
    </update>

    <!--페이징하면 사용-->
    <!--<sql id="criteria">
        <if test="type != null and keyword != null">
            <trim prefix="(" suffix=") AND" prefixOverrides="OR">
                &lt;!&ndash; 전달받은 객체(Criteria)에서 collection에 적당한 typeArr의 getter()를 mapping한다. &ndash;&gt;
                &lt;!&ndash; 즉, Criteria 필드에 getTypeArr()을 사용하여 반복횟수와 값을 결정한다. &ndash;&gt;
                <foreach item="type" collection="typeArr">
                    <trim prefix="OR">
                        <choose>
                            <when test="type == 'T'.toString()">
                                (ACADEMYTITLE LIKE '%' || #{keyword} || '%')
                            </when>
                            <when test="type == 'C'.toString()">
                                (ACADEMYKIND LIKE '%' || #{keyword} || '%')
                            </when>
                            <when test="type == 'W'.toString()">
                                (ACADEMYAREA LIKE '%' || #{keyword} || '%')
                            </when>
                        </choose>
                    </trim>
                </foreach>
            </trim>
        </if>
    </sql>

    <select id="getList" resultType="com.skhuMentoring.dto.Mentor">
        SELECT  mentorNum, mentoringSubject, mentoringMentees, mentoringStartDate, mentoringDetail, mentoringEnd
        FROM
        (SELECT  ROWNUM mentorNum, mentoringSubject, mentoringMentees, mentoringStartDate, mentoringDetail, mentoringEnd
        FROM TBL_MENTOR WHERE
        <include refid="criteria"></include>
        <![CDATA[
      ROWNUM <= #{amount} * #{pageNum})
      WHERE RN >= (#{pageNum} * #{amount}) - 9
      ]]>
    </select>

    <select id="getTotal" resultType="_int">
        SELECT COUNT(*) FROM TBL_MENTOR WHERE
        <include refid="criteria"></include>
        <![CDATA[
      ANO > 0
      ]]>
        &lt;!&ndash; 뒤에 AND가 오니깐 무조건 TRUE인 조건을 하나 붙혀서 오류를 해결한다. &ndash;&gt;
    </select>-->
</mapper>